%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LARGE SINGLE LINE DIAGRAM - OMAE Scenario
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ctikzset{bipoles/thickness=1}
\ctikzset{bipoles/length=0.8cm}
\tikzstyle{trafowind} = [circle, draw, thick, minimum size=0.4cm]
\tikzstyle{fonte} = [font=\footnotesize]
\begin{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Main ac busbar
\draw [ultra thick] (-0.5,0) to (14.5,0);
%\node at (3,0.25) () [anchor=south, fonte] {High Voltage AC Busbar};
%\node at (-0.5,0.25) () [anchor=south west, fonte] {Main High Voltage Busbar}; % $\SI{11}{\kilo \volt}$};
\node at (11.5,0) () [anchor=south, fonte] {$\SI{11}{\kilo \volt}$};
\node at (11.5,0) () [anchor=north, fonte] {\textbf{Platform HV Busbar}};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PHIL
%\draw [dashdotted, thick] (2.4,-0.15) --
%    node[pos=0, anchor=north west, fonte] () {PHIL} ++(3.4,0) --
%    ++(0,-4.75) -- ++(-3.4,0) -- ++(0,4.75) -- cycle;
\node at (4.1,0.5) [anchor=north, fonte] () {Energy Storage};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%gas power
\foreach \x/\y/\t in {0.25/-1/GT1, 1.5/-1/GT2}
{
	\draw (\x,\y-0.245) to [sV]	(\x,\y+0.245) to (\x,\y+1);
	\node at (\x,\y-0.5) () [anchor=north, fonte] {\t};
	\node at (\x,\y-0.75) () [anchor=north, fonte] {\SI{44}{\mega \voltampere}};
	\node at (\x,\y-1) () [anchor=north, fonte] {\SI{35.2}{\mega \watt}};
	\node at (\x,\y-1.25) () [anchor=north, fonte] {$\SI{11}{\kilo \volt}$};
}
\node at (0.875,0.5) () [anchor=north, fonte] {Turbogenerators};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%trafo energy storage system
\node at (3.6,-0.65) (esstrhv) [trafowind] {};
\node at (3.6,-0.95) (esstrlv) [trafowind] {};
\draw [] (3.6,0) to (esstrhv.north);

\node at (esstrhv.east) () [anchor=west, fonte] {ESSTR};
\node at (esstrlv.east) () [anchor=west, fonte] {$\SI{10}{\mega \voltampere}$};

\draw [fonte] (esstrlv.south) to [short] (3.6,-2) to [L, l=ESSL$_{\textrm{ac}}$] (3.6,-3); % coordinate (esscf); 
%\draw [] (esscf) to [L, l=$L$] ++(0,-1); 
\draw [fonte] (3.6,-2) to [C, l=ESSC$_{\textrm{ac}}$] ++(1,0) to [R, l=ESSR$_{\textrm{ac}}$] ++(1,0);
\node at (3.6,-2) () [anchor=east, fonte] {$\SI{0.69}{\kilo \volt}$};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%LSC ESS
\foreach \x/\y in {3.6/-3.4}
{
	\node at (0.2,0.2) [shift={(\x,\y)}, rotate=0] () {$\sim$}; %{\tiny AC}; %
	\node at (-0.2,-0.2) [shift={(\x,\y)}, rotate=0] () {$=$}; %{\tiny DC};
	\node at (0.4,0.15) () [anchor=west, fonte, shift={(\x,\y)}, rotate=0] {ESSGC};
	\node at (0.4,-0.15) () [anchor=west, fonte, shift={(\x,\y)}, rotate=0] {\SI{10}{\mega \voltampere}};
	\draw [shift={(\x,\y)}, rotate=0] (-0.4,0.4) to (0.4,-0.4);
	\draw [thick, shift={(\x,\y)}, rotate=0] (-0.4,0.4) to (0.4,0.4) to (0.4,-0.4) to (-0.4,-0.4) to (-0.4,0.4) to cycle;
}	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%ESS DC Link
\draw [fonte] (3.6,-3.8) to [short] ++(0,-0.8) to [C, l=ESSC$_{\textrm{dc}}$] ++(1.2,0);
\draw [fonte] (3.6,-4.6) to [short] (3.6,-5);
%\node at (4,-4.6) () [anchor=east, fonte] {$\SI{1.2}{\kilo \volt}$};
\draw [ultra thick] (-0.5,-5) to (6,-5);
\node at (-0.5,-4.75) () [anchor=south west, fonte] {ESS dc link};
\node at (-0.5,-5) () [anchor=south west, fonte] {ESSDC $\SI{1.2}{\kilo \volt}$};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%BATTERY, FUEL CELL, ELECTROLYZER
\foreach \x/\y/\t/\p in {0/-5/BT/{4.2}, 2.5/-5/FC/{4}, 5/-5/EL/{6}}
{
	\draw [fonte] (\x,\y) to [short] ++(0, -0.6);
	
	\node at (0.2,0.2) [shift={(\x,\y-1)}, rotate=0] () {$=$}; %{\tiny AC}; %
	\node at (-0.2,-0.2) [shift={(\x,\y-1)}, rotate=0] () {$=$}; %{\tiny DC};
	\draw [shift={(\x,\y-1)}, rotate=0] (-0.4,0.4) to (0.4,-0.4);
	\draw [thick, shift={(\x,\y-1)}, rotate=0] (-0.4,0.4) to (0.4,0.4) to (0.4,-0.4) to (-0.4,-0.4) to (-0.4,0.4) to cycle;
	
	\node at (0.4,0.15) () [anchor=west, fonte, shift={(\x,\y-1)}, rotate=0] {{\t}C};
	\node at (0.4,-0.15) () [anchor=west, fonte, shift={(\x,\y-1)}, rotate=0] {\SI{\p}{\mega \watt}};
	
	\draw [fonte] (\x,\y-1.4) to [L, l={\t}L] ++(0, -1); %, a=\SI{0.6}{\kilo \volt}
}	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Battery
\draw [fonte] (0,-8.2) to [battery1] ++(0,0.8); %, l=BAT, a=\SI{0.6}{\kilo \volt}
\node at (0.4,-7.5) [fonte, anchor=west] {Battery};
\node at (0.4,-7.8) [fonte, anchor=west] {\SI{4.2}{\mega \watt}};
\node at (0.4,-8.1) [fonte, anchor=west] {\SI{0.6}{\kilo \volt}};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Electrolyzer and Fuel Cell
\foreach \x/\y/\t/\p in {2.5/-7.8/Fuel Cell/4, 5/-7.8/Electrolyzer/6}
{
	\draw [thick, shift={(\x,\y)}, rotate=0] (-0.4,0.4) to (0.4,0.4) to (0.4,-0.4) to (-0.4,-0.4) to (-0.4,0.4) to cycle;
	\node at (\x,\y-0.1) () [] {\small H$_2$};
	\node at (0.4,0.3) [fonte, anchor=west, shift={(\x,\y)}, rotate=0] {\t};
	\node at (0.4,0) [fonte, anchor=west, shift={(\x,\y)}, rotate=0] {\SI{\p}{\mega \watt}};
	\node at (0.4,-0.3) [fonte, anchor=west, shift={(\x,\y)}, rotate=0] {\SI{0.6}{\kilo \volt}};
}	
%arrows for electrolyzer and fuel cell
\draw [Stealth-, thick] (2.5,-8.3) to ++(0,-0.35);
\draw [-Stealth, thick] (5,-8.3) to ++(0,-0.35);
%text ESS, batt. plus electrolyzer + fuel cell
\node at (2.5,-8.7) () [fonte, anchor=north] {Energy Storage Devices};
%\node at (4,-7.9) () [] {Battery + Electrolyzer + Fuel Cell};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%flex LOADS
%\foreach \x/\y/\t in {7/0/FLX}
%{
%    %trafo
%    \node at (\x,\y-0.65) (wthv) [trafowind] {};
%    \node at (\x,\y-0.95) (wtlv) [trafowind] {};
%    \draw [] (\x,\y) to (wthv.north);
%    \node at (wthv.east) () [anchor=west, fonte] {{\t}TR};
%    \node at (wtlv.east) () [anchor=west, fonte] {$\SI{8.5}{\mega \voltampere}$};
% 
%    %LCL main reactor
%    \draw [fonte] (wtlv.south) to [short] (\x,\y-2) to [L, l={\t}L$_{\textrm{ac}}$] (\x,\y-3);
%    
%    % LCL capacitor
%    \draw [fonte] (\x,\y-2) to [C, l={\t}C$_{\textrm{ac}}$] ++(1.1,0) to [R, l={\t}R$_{\textrm{ac}}$] ++(1,0);
%    \node at (\x,\y-2) () [anchor=east, fonte] {$\SI{0.69}{\kilo \volt}$};
%
%    %Grid converter
%    \node at (0.2,0.2) [shift={(\x,\y-3.4)}, rotate=0] () {$\sim$}; %{\tiny AC}; %
%	\node at (-0.2,-0.2) [shift={(\x,\y-3.4)}, rotate=0] () {$=$}; %{\tiny DC};
%	\draw [shift={(\x,\y-3.4)}, rotate=0] (-0.4,0.4) to (0.4,-0.4);
%	\draw [thick, shift={(\x,\y-3.4)}, rotate=0] (-0.4,0.4) to (0.4,0.4) to (0.4,-0.4) to (-0.4,-0.4) to (-0.4,0.4) to cycle;
%	\node at (0.4,0.15) () [shift={(\x,\y-3.4)}, rotate=0, anchor=west, fonte] {{\t}GC};
%	\node at (0.4,-0.15) () [shift={(\x,\y-3.4)}, rotate=0, anchor=west, fonte] {\SI{8.5}{\mega \voltampere}};
%
%    %flex load
%    % \draw (\x,\y-3.8) to (\x,\y-4.4);
%    % \node at (\x,\y-4.4) (locload) [shape=regular polygon, fill=white, rotate=180, regular polygon sides=3, minimum size=0.25cm, draw] {};
%    % \node at ($(locload)+(0.25,+0.15)$) [fonte, anchor=west] () {{\t} LOAD};
%    % \node at ($(locload)+(0.25,-0.15)$) [fonte, anchor=west] () {$\SI{7}{\mega \watt}$}; %7.65
%
%	%\draw [fonte] (\x,\y-4.7) to [american controlled voltage source] (\x,\y-4.15) to [short] (\x,\y-3.8); 
%	%\node at (\x+0.25,\y-4.4+0.15) () [anchor=west, fonte] {{\t} LOAD};
%	%\node at (\x+0.25,\y-4.4-0.15) () [anchor=west, fonte] {\SI{7}{\mega \watt}};
%	
%	% \draw [fonte] (\x,\y-5.55) to [american controlled current source] (\x,\y-5) to [short] (\x,\y-4.6);
%	
%	% DC link
%	\draw [fonte] (\x,\y-3.8) to [short] ++(0,-0.8) to [C, l={\t}C$_{\textrm{dc}}$] ++(1.5,0);
%	\node at (\x,\y-3.8-0.8) () [anchor=east, fonte] {$\SI{1.2}{\kilo \volt}$};
%	% \draw [fonte] (\x,\y-5.55) to [american controlled current source] (\x,\y-5) to [short] (\x,\y-4.6);
%	\draw [fonte] (\x,\y-4.6) to [short] (\x,\y-5) to [american controlled current source] (\x,\y-5.55);
%	
%	% wind generator
%	\node at (\x+0.2,\y-5.1) () [anchor=west, fonte] {\t};
%	\node at (\x+0.2,\y-5.1-0.25) () [anchor=west, fonte] {\SI{7}{\mega \watt}};
%    
%}
%\node at (7,0.5) () [anchor=north, fonte] {Flexible Loads};
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%constant power local loads
%\node at (10.2,0.5) () [anchor=north, fonte] {Constant Loads};
%\draw (9.4,0) to ++(0,-1);
%\node at (9.4,-0.8) (locload) [shape=regular polygon, fill=white, rotate=180, regular polygon sides=3, minimum size=0.25cm, draw] {};
%\node at (9.65,-0.65) [fonte, anchor=west] () {CPL};
%\node at (9.65,-0.95) [fonte, anchor=west] () {$\SI{26}{\mega \watt}$};
%constant impedance local loads
\node at (8,0.5) () [anchor=north, fonte] {Constant Impedance Loads};
\draw (8,0) to [short] ++(0,-0.4) to [european resistor] ++(0,-1); 
\node at (8.25,-0.65) [fonte, anchor=west] () {CZL};
\node at (8.25,-0.95) [fonte, anchor=west] () {$\SI{44}{\mega \watt}$};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%trafo wind farm
\node at (14,0.25) () [anchor=center, fonte] {Wind Farm};
\node at (14,-0.65) (wflv) [trafowind] {};
\node at (14,-0.95) (wfhv) [trafowind] {};
\draw [] (14,0) to (wflv.north);

\node at (wflv.east) () [anchor=west, fonte] {WFTR};
\node at (wfhv.east) () [anchor=west, fonte] {$\SI{15}{\mega \voltampere}$};

%wind farm export cable node at platform
\draw [ultra thick] (14.5,-2) to ++(-2.5,0);
\node at (13,-2) () [anchor=south, fonte] {WF $\SI{33}{\kilo \volt}$};

%export cable
\draw [fonte] (wfhv.south) to [short] (14,-5) to [L, a=$\Pi$, l=\SI{4}{\kilo \meter}] ++(0,-1) to [short] ++(0,-2.5);
\draw [fonte] (14,-5) to [C] ++(-1.2,0);
\draw [fonte] (14,-6) to [C] ++(-1.2,0);
\node at (10.5,-6.5) () [fonte] {Underwater collector system ($\Pi$-models)}; 

%WT ac 33kV busbar
\draw [ultra thick] (14.5,-8.5) to ++(-2,0);
\node at (13.5,-8.5) () [anchor=south, fonte] {$\SI{33}{\kilo \volt}$};
\node at (13.2,-8.5) () [anchor=north, fonte] {Floating WT1};

\draw [ultra thick] (12,-8.5) to ++(-3,0);
\node at (10.55,-8.5) () [anchor=south, fonte] {$\SI{33}{\kilo \volt}$};
\node at (10.55,-8.25) () [anchor=south, fonte] {Floating WT2};

\draw [ultra thick] (8.5,-8.5) to ++(-2,0);
\node at (7.5,-8.5) () [anchor=south, fonte] {$\SI{33}{\kilo \volt}$};
\node at (7.9,-8.5) () [anchor=north, fonte] {Floating WT3};

%inter WT 33kV cables
\foreach \x/\y in {8/-8.5, 11.5/-8.5}
{
    \draw [fonte] (\x,\y) to [short] ++(0,1) to [L, l=\SI{2}{\kilo \meter}, a=$\Pi$] ++(1.5,0) to [short] ++(0,-1); 
    \draw [fonte] (\x,\y+1) to [C] ++(0,0.75); 
    \draw [fonte] (\x+1.5,\y+1) to [C] ++(0,0.75); 
}

%WT trafos and MORE
\foreach \x/\y/\t in {7/-8.5/WT3, 10.5/-8.5/WT2, 14/-8.5/WT1}
{
    %trafo
    \node at (\x,\y-0.65) (wthv) [trafowind] {};
    \node at (\x,\y-0.95) (wtlv) [trafowind] {};
    \draw [] (\x,\y) to (wthv.north);
    \node at (wthv.west) () [anchor=east, fonte] {{\t}TR};
    \node at (wtlv.west) () [anchor=east, fonte] {$\SI{5}{\mega \voltampere}$};
    
    %LCL main reactor
    \draw [fonte] (wtlv.south) to [short] (\x,\y-2) to [L, l={\t}L$_{\textrm{ac}}$] (\x,\y-3);
    
    % LCL capacitor
    \draw [fonte] (\x,\y-2) to [C, a={\t}C$_{\textrm{ac}}$] ++(-1.1,0) to [R, a={\t}R$_{\textrm{ac}}$] ++(-1,0);
    \node at (\x,\y-2) () [anchor=west, fonte] {$\SI{0.69}{\kilo \volt}$};

    %Grid converter
    \node at (0.2,0.2) [shift={(\x,\y-3.4)}, rotate=0] () {$\sim$}; %{\tiny AC}; %
	\node at (-0.2,-0.2) [shift={(\x,\y-3.4)}, rotate=0] () {$=$}; %{\tiny DC};
	\draw [shift={(\x,\y-3.4)}, rotate=0] (-0.4,0.4) to (0.4,-0.4);
	\draw [thick, shift={(\x,\y-3.4)}, rotate=0] (-0.4,0.4) to (0.4,0.4) to (0.4,-0.4) to (-0.4,-0.4) to (-0.4,0.4) to cycle;
	\node at (-0.4,0.15) () [shift={(\x,\y-3.4)}, rotate=0, anchor=east, fonte] {{\t}GC};
	\node at (-0.4,-0.15) () [shift={(\x,\y-3.4)}, rotate=0, anchor=east, fonte] {\SI{5}{\mega \voltampere}};
	
	% DC link
	%\draw [fonte] (\x,\y-3.8) to [short] ++(0,-0.8) to [C, a={\t}C$_{\textrm{dc}}$] ++(-1.5,0);
	%\node at (\x,\y-3.8-0.4) () [anchor=west, fonte] {$\SI{1.2}{\kilo \volt}$};
	\draw [fonte] (\x,\y-4.65) to [american controlled voltage source] (\x,\y-4.1) to [short] (\x,\y-3.8);
	
	% wind generator
	\node at (\x+0.2,\y-4.1) () [anchor=west, fonte] {\t};
    \node at (\x+0.2,\y-4.1-0.25) () [anchor=west, fonte] {\SI{4}{\mega \watt}};
	\node at (\x+0.2,\y-4.1-0.5) () [anchor=west, fonte] {\SI{1.2}{\kilo \volt}};
}
\end{tikzpicture}
