\tikzstyle{block} = [draw, rectangle, fill=white, minimum height=1cm, minimum width=1cm, font=\footnotesize]
\tikzstyle{caixa} = [rectangle, draw, fill=white, text width=1.25cm, text centered, minimum height=1cm, font=\footnotesize ] %,text width=2cm minimum width=2.2cm
\tikzstyle{caixalarga} = [rectangle, draw, fill=white, text width=2.0cm, text centered, minimum height=1cm, font=\footnotesize ] %,text width=2cm minimum width=2.2cm
\tikzstyle{sum} = [draw, circle, font=\footnotesize]
\tikzstyle{fonte} = [font=\footnotesize]
    
\begin{tikzpicture}[>=latex'] %https://www.youtube.com/watch?v=5jmIHOWpEg0 minute 12:16
%%%%%%%%%%%%%%%%%%%%%%%%
% FCR - frequency summation
   \node at (-2.75,0.755) [fonte] () {Voltage to be tracked};
   
   \node at (0,0) [sum] (dotprod) {$\bullet$};
   \node at ($(dotprod)+(1.5,0)$) [caixa] (PI) {PI\\regulator}; 
   \node at ($(dotprod)+(0,0.5)$) [fonte,anchor=south] () {Dot product}; % {\begin{tabular}Dot\\product\end{tabular}};
   \node at ($(PI)+(1.8,0)$) [sum] (SumOmega) {$\Sigma$};
   \node at ($(SumOmega)+(1.75,0)$) [caixa] (Int) {Integrator};
    %\node at (Int.north) [anchor=south,fonte] () {Wrapped around $2\pi$};
   \node at ($(Int)+(2.75,0)$) [caixalarga] (coseno) {{$\cos  ( \, \widehat{\theta} \, )$\\$\cos ( \, \widehat{\theta} -2 \pi/3)$\\$\cos ( \, \widehat{\theta} + 2\pi /3)$}}; 
    %\node at ($(coseno)+(0,2)$) [caixalarga] (seno) {{$\sin(\omega_\textrm{PLL} t)$\\$\sin(\omega_\textrm{PLL} t -2 \pi/3 )$\\$\sin(\omega_\textrm{PLL} t + 2\pi /3)$}}; 
    
    \node at (coseno.north) [fonte, anchor=south] () {Internal voltage generator};
    \node at (Int.north) [fonte, anchor=south] () {Wrapped around $2\pi$};
        
    \draw [fonte,<-] (dotprod) --
        node [anchor=east,pos=1.0] () {$\matr{v}(\theta) = V \begin{bmatrix} \sin (\theta) \\ \sin (\theta - 2 \pi/3) \\ \sin (\theta + 2\pi /3\end{bmatrix}$}
        ++(-1,0); % =\matr{v}(\theta)

    \node at ($(dotprod)+(-2.6,-1.25)$) [anchor=south, fonte] () {$\theta (t)\!=\!\int_{0}^{t} \omega (\tau) \textrm{d} \tau$};
        
    \draw [fonte,->] (dotprod) --
        node [anchor=south,pos=0.5] () {$\varepsilon$} (PI);
    \draw [fonte,->] (PI) --
        node [anchor=south,pos=0.3] () {$\Delta \widehat{\omega}$} 
        node [anchor=south,pos=0.9] () {$+$} (SumOmega);
    \draw [fonte,<-] (SumOmega) --
        node [anchor=west,pos=0.1] () {$+$} ++(0,1) --
        node [anchor=east,pos=1.0] () {$\omega_n$} ++(-0.5,0);
    \draw [fonte,->] (SumOmega) --
        node [anchor=south,pos=0.5] () {$\widehat{\omega}$} 
        (Int); % node [anchor=north,pos=0.5] () {$\omega_\textrm{PLL}$}
    \draw [fonte,->] (Int) --
        node [anchor=south,pos=0.5] () {$\widehat{\theta}$}
        (coseno); % if seno is on, pos=0.3, $\omega_\textrm{PLL}t$
    %\draw [fonte,->] ($(coseno.west)+(-0.4,0)$) -- ++(0,2) -- (seno);
    %\fill ($(coseno.west)+(-0.4,0)$) circle [radius=1pt];
    \draw [fonte,->] (coseno.east) 
        -- ++(0.35,0) -- ++(0,-1.5)
        -- (0,-1.5) -- 
        node [anchor=west,pos=0.5] () {$\matr{v}_\textrm{PLL} ( \, \widehat{\theta}\,)$}
        (dotprod);

    \draw [densely dotted, ->] ($(SumOmega)+(0.65,-0.1)$) to
        node [pos=1, anchor=north, fonte] () {Estimated value of $\omega$}
        ++(-0.4,-0.75);

    \draw [densely dotted, ->] ($(Int)+(1.2,-0.1)$) to
        node [pos=1, anchor=north, fonte] () {Estimated value of $\theta$}
        ++(0.1,-0.75);
        
\end{tikzpicture}

%= \begin{bmatrix}
        %    \cos\left( \widehat{\theta} \right)\\
        %    \cos\left( \widehat{\theta} - 2\pi /3\right) \\
        %    \cos\left( \widehat{\theta} + 2\pi /3\right)
%\end{bmatrix}$}
